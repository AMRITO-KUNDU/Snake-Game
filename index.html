<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snake Game</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            font-family: 'Arial', sans-serif;
            overflow: hidden;
        }

        canvas {
            border: 5px solid #ffffff;
            border-radius: 15px;
            background-color: #111;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
        }

        #score {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 28px;
            font-weight: bold;
            color: #ffffff;
            z-index: 10;
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.7);
        }

        #gameOver {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            background-color: rgba(0, 0, 0, 0.8);
            padding: 30px;
            border-radius: 20px;
            color: #ffffff;
            font-size: 48px;
            font-weight: bold;
            z-index: 20;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.7);
            animation: fadeIn 1s ease-out;
            cursor: pointer;
        }

        #gameOver span {
            display: block;
            margin-top: 20px;
            font-size: 24px;
            color: #ff5555;
            animation: blink 1.5s infinite;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <div id="score">Score: 0</div>
    <div id="gameOver">Game Over<br><span>Tap to Restart</span></div>
    <canvas id="gameCanvas"></canvas>
    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const scoreElement = document.getElementById("score");
        const gameOverElement = document.getElementById("gameOver");

        let scale;
        let snake;
        let food;
        let score = 0;
        let gameInterval;
        let touchStartX = 0;
        let touchStartY = 0;
        let gameSpeed = 100;

        function resizeCanvas() {
            const minDimension = Math.min(window.innerWidth, window.innerHeight);
            scale = Math.floor(minDimension / 30);
            if (scale < 10) scale = 10;  // Set a minimum scale for very small screens
            canvas.width = scale * 30;   // Limit the game grid size to 30x30 cells
            canvas.height = scale * 30;
            startGame();
        }

        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        function startGame() {
            clearInterval(gameInterval);
            snake = new Snake();
            food = new Food();
            food.pickLocation();
            score = 0;
            gameSpeed = 100;
            scoreElement.textContent = `Score: ${score}`;
            gameOverElement.style.display = 'none';

            gameInterval = window.setInterval(gameLoop, gameSpeed);

            document.addEventListener('keydown', event => snake.changeDirection(event));
            canvas.addEventListener('touchstart', handleTouchStart, { passive: true });
            canvas.addEventListener('touchmove', handleTouchMove, { passive: true });
        }

        function gameLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            food.draw();
            snake.update();
            snake.draw();

            if (snake.eat(food)) {
                food.pickLocation();
                score++;
                scoreElement.textContent = `Score: ${score}`;
                increaseSpeed();
            }

            if (snake.checkCollision() || snake.hitBoundary()) {
                gameOver();
            }
        }

        function increaseSpeed() {
            if (gameSpeed > 50) {
                gameSpeed -= 2;
                clearInterval(gameInterval);
                gameInterval = window.setInterval(gameLoop, gameSpeed);
            }
        }

        function gameOver() {
            clearInterval(gameInterval);
            gameOverElement.style.display = 'block';
            gameOverElement.addEventListener('click', restartGame, { once: true });
        }

        function restartGame() {
            startGame();
        }

        function Snake() {
            this.x = 0;
            this.y = 0;
            this.xSpeed = scale;
            this.ySpeed = 0;
            this.total = 0;
            this.tail = [];

            this.draw = function() {
                ctx.fillStyle = "#32cd32";
                ctx.strokeStyle = "#ffffff";

                for (let i = 0; i < this.tail.length; i++) {
                    ctx.fillRect(this.tail[i].x, this.tail[i].y, scale, scale);
                    ctx.strokeRect(this.tail[i].x, this.tail[i].y, scale, scale);
                }

                ctx.fillRect(this.x, this.y, scale, scale);
                ctx.strokeRect(this.x, this.y, scale, scale);
            };

            this.update = function() {
                for (let i = 0; i < this.tail.length - 1; i++) {
                    this.tail[i] = this.tail[i + 1];
                }

                if (this.total >= 1) {
                    this.tail[this.total - 1] = { x: this.x, y: this.y };
                }

                this.x += this.xSpeed;
                this.y += this.ySpeed;
            };

            this.changeDirection = function(event) {
                if (event.keyCode === 37 && this.xSpeed === 0) {
                    this.xSpeed = -scale;
                    this.ySpeed = 0;
                } else if (event.keyCode === 38 && this.ySpeed === 0) {
                    this.ySpeed = -scale;
                    this.xSpeed = 0;
                } else if (event.keyCode === 39 && this.xSpeed === 0) {
                    this.xSpeed = scale;
                    this.ySpeed = 0;
                } else if (event.keyCode === 40 && this.ySpeed === 0) {
                    this.ySpeed = scale;
                    this.xSpeed = 0;
                }
            };

            this.eat = function(food) {
                if (this.x === food.x && this.y === food.y) {
                    this.total++;
                    return true;
                }
                return false;
            };

            this.checkCollision = function() {
                for (let i = 0; i < this.tail.length; i++) {
                    if (this.x === this.tail[i].x && this.y === this.tail[i].y) {
                        return true;
                    }
                }
                return false;
            };

            this.hitBoundary = function() {
                return this.x >= canvas.width || this.y >= canvas.height || this.x < 0 || this.y < 0;
            };
        }

        function handleTouchStart(event) {
            const touch = event.touches[0];
            touchStartX = touch.clientX;
            touchStartY = touch.clientY;
        }

        function handleTouchMove(event) {
            if (!touchStartX || !touchStartY) {
                return;
            }

            const touchEndX = event.touches[0].clientX;
            const touchEndY = event.touches[0].clientY;

            const diffX = touchEndX - touchStartX;
            const diffY = touchEndY - touchStartY;

            if (Math.abs(diffX) > Math.abs(diffY)) {
                if (diffX > 0 && snake.xSpeed === 0) {
                    snake.xSpeed = scale;
                    snake.ySpeed = 0;
                } else if (diffX < 0 && snake.xSpeed === 0) {
                    snake.xSpeed = -scale;
                    snake.ySpeed = 0;
                }
            } else {
                if (diffY > 0 && snake.ySpeed === 0) {
                    snake.ySpeed = scale;
                    snake.xSpeed = 0;
                } else if (diffY < 0 && snake.ySpeed === 0) {
                    snake.ySpeed = -scale;
                    snake.xSpeed = 0;
                }
            }

            touchStartX = null;
            touchStartY = null;
        }

        function Food() {
            this.x;
            this.y;

            this.pickLocation = function() {
                this.x = Math.floor(Math.random() * Math.floor(canvas.width / scale)) * scale;
                this.y = Math.floor(Math.random() * Math.floor(canvas.height / scale)) * scale;
            };

            this.draw = function() {
                ctx.fillStyle = "#ff4444"; /* Red color for food */
                ctx.strokeStyle = "#ffffff"; /* White border for better visibility */
                ctx.beginPath();
                ctx.arc(this.x + scale / 2, this.y + scale / 2, scale / 2, 0, 2 * Math.PI);
                ctx.fill();
                ctx.stroke();
            };
        }
    </script>
</body>
</html>
